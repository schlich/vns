---
title: "VNS Analysis"
author: "Tyler Schlichenmeyer"
format: dashboard
server: shiny
execute: 
  keep-ipynb: true
---

```{python}
import os
from pathlib import Path
import matplotlib.pyplot as plt
from shiny import render, ui, reactive
```


## {.toolbar}

```{python}
from pathlib import Path
import polars as pl

from vns import Session

sessions = [Session(path=path) for path in Path("../data/BFINAC_VNS").iterdir()]

first_session = next(iter(sessions))

ui.input_select("session", "Session", choices={str(session.path): session.path.stem for session in sessions}, selected=first_session,)
trials = Session(path=first_session.path).get_trials()

ui.input_select("trial", "Trial", choices=trials.select("trialnumber").collect().get_column("trialnumber").to_list())

```


```{python}
import datetime
import matplotlib.animation as animation
import matplotlib.pyplot as plt
from matplotlib.collections import PatchCollection
from matplotlib.patches import Ellipse, Rectangle
from shiny import render
import pandas as pd
import polars as pl

from vns import Trial

@render.ui
def trial_animation():
    session = Session(path=Path(input.session()))
    trial_data = session.get_trials()
    trial_id = input.trial()
    trial = Trial(path=session.path / trial_id)

    ani = trial.animate()
    
    return ui.HTML(ani.to_jshtml(fps=10))
    
```